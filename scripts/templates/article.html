{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block head_extra %}
    <link href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
{% endblock %}

{% block style_extra %}
    /* --- Pygments 代码高亮 (仅一套) --- */
    {{ pygments_css | safe }}

    /* 修正代码块背景色，使其柔和一点 */
    .markdown-body .highlight pre, .markdown-body pre {
        background-color: #f6f8fa;
        border-radius: 6px;
    }

    /* --- 文章页特定布局 --- */
    .breadcrumbs {
        font-family: var(--font-serif); /* 确保衬线体 */
        font-size: 14px;
        color: var(--color-muted);
        margin-bottom: 40px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .breadcrumbs .current { font-weight: 600; color: var(--color-fg); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    .doc-header { margin-bottom: 56px; padding-bottom: 24px; border-bottom: 1px solid var(--color-border); }
    .doc-title { margin: 0 0 16px 0; font-size: 2.6em; font-weight: 700; line-height: 1.3; letter-spacing: -0.02em; }

    .doc-meta {
        font-family: var(--font-serif); /* 确保衬线体 */
        font-size: 14px;
        color: var(--color-muted);
        display: flex; flex-wrap: wrap; gap: 16px; align-items: center;
    }
    .meta-item { display: flex; align-items: center; }

    .tag-pill {
        background: rgba(201,58,64,0.08); color: var(--color-accent);
        padding: 2px 8px; border-radius: 20px; font-size: 12px; font-weight: 500;
    }

    .doc-summary {
        font-family: var(--font-serif);
        margin-bottom: 56px; padding: 24px 32px;
        background-color: rgba(125, 133, 144, 0.04); border-left: 3px solid var(--color-accent);
        font-style: italic; font-size: 1.05em;
    }

    /* --- Markdown 样式重置 (关键) --- */
    .markdown-body {
        /* !important 强制覆盖 github-markdown.css 的无衬线字体 */
        font-family: var(--font-serif) !important;

        background: transparent;
        font-size: 18px;
        color: var(--color-fg);
    }

    /* 确保标题也强制使用衬线体 */
    .markdown-body h1, .markdown-body h2, .markdown-body h3,
    .markdown-body h4, .markdown-body h5, .markdown-body h6 {
        font-family: var(--font-serif) !important;
        border-bottom: none;
        font-weight: 700;
        margin-top: 1.6em;
    }

    .markdown-body a { color: var(--color-accent); text-decoration: none; }
    .markdown-body a:hover { text-decoration: underline; }

    /* 代码块保留等宽字体 */
    .markdown-body pre, .markdown-body code { font-family: var(--font-mono) !important; font-size: 0.85em; }

    @media (max-width: 767px) {
        .doc-title { font-size: 2em; }
        .markdown-body { font-size: 17px; }
    }
{% endblock %}

{% block content %}
    <nav class="breadcrumbs">
        <a href="index.html">
            <svg class="icon icon-mr" viewBox="0 0 16 16"><path d="M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z"></path></svg>
            Home
        </a>
        <span style="opacity:0.5">/</span>
        <span class="current" title="{{ title }}">{{ title }}</span>
    </nav>

    <header class="doc-header">
        <h1 class="doc-title">{{ title }}</h1>
        <div class="doc-meta">
            {% if date %}
            <span class="meta-item">
                <svg class="icon icon-sm icon-mr" viewBox="0 0 16 16"><path d="M4.75 0a.75.75 0 0 1 .75.75V2h5V.75a.75.75 0 0 1 1.5 0V2h1.25c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 13.25 16H2.75A1.75 1.75 0 0 1 1 14.25V3.75C1 2.784 1.784 2 2.75 2H4V.75A.75.75 0 0 1 4.75 0ZM1.75 6h12.5v8.25a.25.25 0 0 1-.25.25H2.75a.25.25 0 0 1-.25-.25V6Z"></path></svg>
                {{ date }}
            </span>
            {% endif %}

            {% if author %}
            <span class="meta-item">
                <svg class="icon icon-sm icon-mr" viewBox="0 0 16 16"><path d="M10.561 8.073a6.005 6.005 0 0 1 3.432 5.142.75.75 0 1 1-1.498.07 4.5 4.5 0 0 0-8.99 0 .75.75 0 0 1-1.498-.07 6.004 6.004 0 0 1 3.431-5.142 3.999 3.999 0 1 1 5.123 0ZM10.5 5a2.5 2.5 0 1 0-5 0 2.5 2.5 0 0 0 5 0Z"></path></svg>
                {{ author }}
            </span>
            {% endif %}

            {% if tags %}
            <div class="meta-item" style="gap:6px;">
                {% for tag in tags %}
                <span class="tag-pill">#{{ tag }}</span>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </header>

    {% if summary_html %}
    <div class="doc-summary">
        {{ summary_html | safe }}
    </div>
    {% endif %}

    <article class="markdown-body">
        {{ content | safe }}
    </article>
{% endblock %}

{% block scripts_extra %}
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" onload="initMath()"></script>
    <script>
        function initMath() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false},
                    {left: '\\(', right: '\\)', display: false},
                    {left: '\\[', right: '\\]', display: true}
                ],
                throwOnError : false
            });
        }
    </script>
{% endblock %}
